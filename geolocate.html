<!DOCTYPE html>
	<head>
		<title>Energe</title>
		<link href="assets/stylesheets/energe.css" rel="stylesheet" type="text/css">
		<script src="assets/javascript/energe.js"></script>
		<script src="http://code.jquery.com/jquery-1.10.2.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	</head>
	<body style ='background-color: rgb(35, 35, 35)'>
    <div class="header">
      <a href='/'>
        <img src="assets/images/logo-2.png" width="215px" height="97px" class='logo'>
      </a>
      <a href="/geolocate">
        <div class="subtitle" style="height:27px;">GEOLOCATE</div>
      </a>
      <a href="/about">
        <div class="subtitle" style="height:27px;">ABOUT</div>
      </a>
			<div class="ui-widget">
				<label for="tags"></label>
				<!-- TODO disabled -->
				<input class="tags" type="text" placeholder="Search City" >
				<input class="search" type="submit" value="Submit">
				<!-- <div class="button">SEARCH</div> -->
			</div>
    </div>
		<div class="geolocate_background">
			<!-- <div class="title">LOCATION.</div> -->
			<div class="user_prompt">
				<div class="button current">CURRENT LOCATION</div>
				<div class="button custom">ENTER LOCATION</div>
			</div>
		</div>
	</body>
</html>

<script>
	var locations = [
	  "ALBUQUERQUE, NEW MEXICO",
		"ANAHEIM, CALIFORNIA",
		"ARLINGTON, TEXAS",
		"ATLANTA, GEORGIA",
		"AURORA, COLORADO",
		"AUSTIN, TEXAS",
		"BAKERSFIELD, CALIFORNIA",
		"BALTIMORE, MARYLAND",
		"BATON ROUGE, LOUISIANA",
		"BIRMINGHAM, ALABAMA",
		"BOISE, IDAHO",
		"BOSTON, MASSACHUSETTS",
		"BUFFALO, NEW YORK",
		"CHARLOTTE, NORTH CAROLINA",
		"CHICAGO, ILLINOIS",
		"CINCINNATI, OHIO",
		"CLEVELAND, OHIO",
		"COLORADO SPRINGS, COLORADO",
		"COLUMBUS, OHIO",
		"CORPUS CHRISTI, TEXAS",
		"DALLAS, TEXAS",
		"DENVER, COLORADO",
		"DETROIT, MICHIGAN",
		"EL PASO, TEXAS",
		"FORT WORTH, TEXAS",
		"FRESNO, CALIFORNIA",
		"FRISCO, TEXAS",
		"GARLAND, TEXAS",
		"GREENSBORO, NORTH CAROLINA",
		"HENDERSON, NEVADA",
		"HOUSTON, TEXAS",
		"INDIANAPOLIS, INDIANA",
		"JACKSONVILLE, FLORIDA",
		"KANSAS CITY, MISSOURI",
		"LAS VEGAS, NEVADA",
		"LINCOLN, NEBRASKA",
		"LITTLE ROCK, ARKANSAS",
		"LOS ANGELES, CALIFORNIA",
		"LOUISVILLE, KENTUCKY",
		"MADISON, WISCONSIN",
		"MEMPHIS, TENNESSEE",
		"MESA, ARIZONA",
		"MESQUITE, TEXAS",
		"MIAMI, FLORIDA",
		"MILWAUKEE, WISCONSIN",
		"MINNEAPOLIS, MINNESOTA",
		"MONTGOMERY, ALABAMA",
		"NASHVILLE, TENNESSEE",
		"NEW ORLEANS, LOUISIANA",
		"NEW YORK, NEW YORK",
		"NEWARK, NEW JERSEY",
		"OAKLAND, CALIFORNIA",
		"OKLAHOMA CITY, OKLAHOMA",
		"OMAHA, NEBRASKA",
		"ORLANDO, FLORIDA",
		"PHILADELPHIA, PENNSYLVANIA",
		"PHOENIX, ARIZONA",
		"PLANO, TEXAS",
		"PORTLAND, OREGON",
		"PROVIDENCE, RHODE ISLAND",
		"RALEIGH, NORTH CAROLINA",
		"RENO, NEVADA",
		"RICHMOND, VIRGINIA",
		"SACRAMENTO, CALIFORNIA",
		"SALT LAKE CITY, UTAH",
		"SAN ANTONIO, TEXAS",
		"SAN DIEGO, CALIFORNIA",
		"SAN FRANCISCO, CALIFORNIA",
		"SAN JOSE, CALIFORNIA",
		"SANTA ANA, CALIFORNIA",
		"SEATTLE, WASHINGTON",
		"ST.LOUIS, MISSOURI",
		"STOCKTON, CALIFORNIA",
		"TAMPA, FLORIDA",
		"TOLEDO, OHIO",
		"TUCSON, ARIZONA",
		"TULSA, OKLAHOMA",
		"WICHITA, KANSAS"];

	 $( ".tags" ).autocomplete({
	    source: locations,
	    messages: {
	      noResults: '',
	      results: function() {}
	    }
	  });

	var mappingInfo;
	$.get('assets/data/mapping.json', function(data) {    
	    mappingInfo = JSON.parse(data);
	});

  var locationInfo;
	$.get('assets/data/locations.json', function(data) {    
	    locationInfo = data;
	    console.log(locationInfo["great plains"]);
	});


	//when current location is clicked, find the current location, and paste it into the input box and auto search
	$('body').on('click', '.button.current', function(args) {
		$(args.currentTarget).closest('.user_prompt').remove();
		$(".tags").prop('disabled', false);
		$.getJSON('http://freegeoip.net/json/', function(location) {
			//if ip address is trackable
			console.log(locationInfo);
			if (location.city && location.region_name) {
			 	search(location.city, location.region_name);
			};
		});
	})


	$('body').on('click', '.button.custom', function(args) {
		$(args.currentTarget).closest('.user_prompt').remove();
		$(".tags").prop('disabled', false);
	})


	$('body').on('click', '.search', function(args) {
		var query = $('.tags').val();
		if (query.split(', ').length > 1) {
			var components = query.split(', ');
			var city = components[0]; var state = components[1];
			search(city, state);
		}
		else {
			alert('Your query doesn\'t match our "city, state" format');
		};

	})

	function search(city, state) {
		if (jQuery.inArray(city.toUpperCase() + ', ' + state.toUpperCase(), locations) == -1) {
			alert('City not found in our database, please try another location.');
			return;
		}
		$(".tags").val(city.toUpperCase() + ', ' + state.toUpperCase())
		var region = mappingInfo[state.toLowerCase()];


	 	$.ajax({
      url: "http://michaelscaria.herokuapp.com/location?state=" +state.toLowerCase()+ "&city="+"dallas",
      success: function( data ) {
        //https://s3-us-west-1.amazonaws.com/michaelscaria/location/texas/Dallas.png
        // console.log(data['image_url'])
        $('.geolocate_background').replaceWith('<a href="http://www.google.com"><div class="location_image" style="background-image: url(\'' +data['image_url']+'\');"></div></a>');

        // console.log(locationInfo[state.toLowerCase()][city.toLowerCase()]);
        // var facts = locationInfo[location.region_name.toLowerCase()][location.city.toLowerCase()];
        var facts = locationInfo[state.toLowerCase()]['dallas'];
        var factsDiv = '<div class="facts">'
        for (var i = 0; i < facts.length; i++) {
        	// console.log(facts[i])
        	factsDiv = factsDiv +'<div class="fact">' +facts[i].toUpperCase()+ '</div>';
        };
        factsDiv = factsDiv + '</div>';
        $('.location_image').append(factsDiv);
      }
    });
	}

</script>

